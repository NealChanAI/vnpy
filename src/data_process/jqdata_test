#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
èšå®½JQData - æœŸè´§åˆ†é’Ÿæ•°æ®ä¸‹è½½æµ‹è¯•
"""

from jqdatasdk import *
from datetime import datetime, timedelta

# 1. è®¤è¯ç™»å½•
auth('13716539053', 'Nealchan1001')
print("âœ… ç™»å½•æˆåŠŸ")

# 2. æŸ¥è¯¢å‰©ä½™è°ƒç”¨æ¬¡æ•°
count = get_query_count()
print(f"ğŸ“Š ä»Šæ—¥å‰©ä½™è°ƒç”¨æ¬¡æ•°: {count}")

# 3. æµ‹è¯•ï¼šè·å–æœŸè´§åˆçº¦åˆ—è¡¨
print("\n" + "="*50)
print("è·å–æœŸè´§åˆçº¦åˆ—è¡¨")
print("="*50)

# è·å–èºçº¹é’¢ä¸»åŠ›åˆçº¦
futures_list = get_all_securities(types=['futures'], date=datetime.now())
rb_futures = futures_list[futures_list.index.str.startswith('RB')]
print(f"èºçº¹é’¢åˆçº¦æ•°é‡: {len(rb_futures)}")
print(rb_futures.head())

# 4. æµ‹è¯•ï¼šä¸‹è½½1åˆ†é’Ÿæ•°æ®
print("\n" + "="*50)
print("ä¸‹è½½1åˆ†é’Ÿæ•°æ®æµ‹è¯•")
print("="*50)

# è·å–æœ€æ–°çš„èºçº¹é’¢ä¸»åŠ›åˆçº¦ï¼ˆè¯•ç”¨è´¦å·æ—¶é—´é™åˆ¶ï¼š2024-07-16è‡³2025-07-23ï¼‰
symbol = 'RB2512.XSGE'  # èºçº¹é’¢2512åˆçº¦ï¼ˆåœ¨å…è®¸çš„æ—¶é—´èŒƒå›´å†…ï¼‰
# ä½¿ç”¨æ˜ç¡®åœ¨èŒƒå›´å†…çš„æ—¥æœŸ
start_date = datetime(2024, 12, 1)  
end_date = datetime(2024, 12, 31)

# ä½¿ç”¨get_priceè·å–åˆ†é’Ÿæ•°æ®
df = get_price(
    symbol,
    start_date=start_date.strftime('%Y-%m-%d'),
    end_date=end_date.strftime('%Y-%m-%d'),
    frequency='1m',  # 1åˆ†é’Ÿ
    fields=['open', 'high', 'low', 'close', 'volume', 'money'],
    skip_paused=False,
    fq='none'  # ä¸å¤æƒ
)

print(f"âœ… æˆåŠŸä¸‹è½½æ•°æ®: {len(df)} æ¡")
print(df.head())
print(df.tail())

# 5. æŸ¥çœ‹å‰©ä½™æ¬¡æ•°
count_after = get_query_count()
print(f"\nğŸ“Š å‰©ä½™è°ƒç”¨æ¬¡æ•°: {count_after}")
