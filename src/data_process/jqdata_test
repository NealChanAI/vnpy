#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
聚宽JQData - 期货分钟数据下载测试
"""

from jqdatasdk import *
from datetime import datetime, timedelta

# 1. 认证登录
auth('13716539053', 'Nealchan1001')
print("✅ 登录成功")

# 2. 查询剩余调用次数
count = get_query_count()
print(f"📊 今日剩余调用次数: {count}")

# 3. 测试：获取期货合约列表
print("\n" + "="*50)
print("获取期货合约列表")
print("="*50)

# 获取螺纹钢主力合约
futures_list = get_all_securities(types=['futures'], date=datetime.now())
rb_futures = futures_list[futures_list.index.str.startswith('RB')]
print(f"螺纹钢合约数量: {len(rb_futures)}")
print(rb_futures.head())

# 4. 测试：下载1分钟数据
print("\n" + "="*50)
print("下载1分钟数据测试")
print("="*50)

# 获取最新的螺纹钢主力合约（试用账号时间限制：2024-07-16至2025-07-23）
symbol = 'RB2512.XSGE'  # 螺纹钢2512合约（在允许的时间范围内）
# 使用明确在范围内的日期
start_date = datetime(2024, 12, 1)  
end_date = datetime(2024, 12, 31)

# 使用get_price获取分钟数据
df = get_price(
    symbol,
    start_date=start_date.strftime('%Y-%m-%d'),
    end_date=end_date.strftime('%Y-%m-%d'),
    frequency='1m',  # 1分钟
    fields=['open', 'high', 'low', 'close', 'volume', 'money'],
    skip_paused=False,
    fq='none'  # 不复权
)

print(f"✅ 成功下载数据: {len(df)} 条")
print(df.head())
print(df.tail())

# 5. 查看剩余次数
count_after = get_query_count()
print(f"\n📊 剩余调用次数: {count_after}")
