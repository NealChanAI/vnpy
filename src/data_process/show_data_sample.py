#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""æŸ¥çœ‹æœŸè´§æ•°æ®æ ·æœ¬å¹¶è§£é‡Šå­—æ®µå«ä¹‰"""

from datetime import datetime
from vnpy.trader.database import get_database
from vnpy.trader.constant import Exchange, Interval

# è·å–æ•°æ®åº“
database = get_database()

# æŸ¥è¯¢èºçº¹é’¢æ•°æ®
bars = database.load_bar_data(
    symbol='rb2505',
    exchange=Exchange.SHFE,
    interval=Interval.MINUTE,
    start=datetime(2024, 12, 1),
    end=datetime(2024, 12, 31)
)

print("=" * 80)
print("æœŸè´§1åˆ†é’Ÿæ•°æ®æ ·æœ¬ - èºçº¹é’¢ RB2505")
print("=" * 80)

if bars:
    print(f"\næ€»æ•°æ®é‡: {len(bars)} æ¡\n")
    print("å‰10æ¡æ•°æ®å±•ç¤º:\n")
    
    # è¡¨å¤´
    print(f"{'åºå·':<4} {'æ—¶é—´':<20} {'å¼€ç›˜':<8} {'æœ€é«˜':<8} {'æœ€ä½':<8} "
          f"{'æ”¶ç›˜':<8} {'æˆäº¤é‡':<10} {'æˆäº¤é¢':<12}")
    print("-" * 80)
    
    # å±•ç¤ºå‰10æ¡æ•°æ®
    for i, bar in enumerate(bars[:10], 1):
        print(f"{i:<4} {str(bar.datetime):<20} {bar.open_price:<8.1f} "
              f"{bar.high_price:<8.1f} {bar.low_price:<8.1f} {bar.close_price:<8.1f} "
              f"{bar.volume:<10.0f} {bar.turnover:<12.0f}")
    
    print("\n" + "=" * 80)
    print("å­—æ®µè¯¦ç»†è¯´æ˜")
    print("=" * 80)
    
    # å–ç¬¬ä¸€æ¡æ•°æ®åšè¯¦ç»†è¯´æ˜
    bar = bars[0]
    
    print(f"""
â”Œâ”€ åŸºç¡€ä¿¡æ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”‚ symbol         : {bar.symbol}
â”‚ è¯´æ˜           : åˆçº¦ä»£ç ï¼ˆå°å†™ï¼‰
â”‚ ç¤ºä¾‹           : rb2505 è¡¨ç¤ºèºçº¹é’¢2025å¹´5æœˆåˆçº¦
â”‚
â”‚ exchange       : {bar.exchange.value}
â”‚ è¯´æ˜           : äº¤æ˜“æ‰€ä»£ç 
â”‚ å¯é€‰å€¼         : SHFE(ä¸ŠæœŸæ‰€), DCE(å¤§å•†æ‰€), CZCE(éƒ‘å•†æ‰€), 
â”‚                 CFFEX(ä¸­é‡‘æ‰€), INE(èƒ½æºä¸­å¿ƒ)
â”‚
â”‚ datetime       : {bar.datetime}
â”‚ è¯´æ˜           : Kçº¿æ—¶é—´æˆ³ï¼ˆè¯¥åˆ†é’Ÿçš„å¼€å§‹æ—¶é—´ï¼‰
â”‚ æ ¼å¼           : YYYY-MM-DD HH:MM:SS+æ—¶åŒº
â”‚ æ³¨æ„           : è¿™æ˜¯Kçº¿æŸ±çš„å¼€å§‹æ—¶é—´ï¼Œæ”¶ç›˜æ—¶é—´ä¸ºä¸‹ä¸€åˆ†é’Ÿ
â”‚
â”‚ interval       : {bar.interval.value}
â”‚ è¯´æ˜           : æ•°æ®å‘¨æœŸ
â”‚ å¯é€‰å€¼         : 1m(1åˆ†é’Ÿ), 1h(1å°æ—¶), d(æ—¥çº¿), w(å‘¨çº¿)
â”‚
â”‚ gateway_name   : {bar.gateway_name}
â”‚ è¯´æ˜           : æ•°æ®æ¥æºæ ‡è¯†
â”‚ ç¤ºä¾‹           : JQDATAè¡¨ç¤ºæ¥è‡ªèšå®½æ•°æ®
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€ ä»·æ ¼ä¿¡æ¯ï¼ˆOHLCï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”‚ open_price     : {bar.open_price}
â”‚ è¯´æ˜           : å¼€ç›˜ä»· - è¯¥åˆ†é’Ÿç¬¬ä¸€ç¬”æˆäº¤ä»·æ ¼
â”‚ å•ä½           : å…ƒ/å¨ï¼ˆèºçº¹é’¢ï¼‰
â”‚
â”‚ high_price     : {bar.high_price}
â”‚ è¯´æ˜           : æœ€é«˜ä»· - è¯¥åˆ†é’Ÿå†…çš„æœ€é«˜æˆäº¤ä»·
â”‚ ç”¨é€”           : ç”¨äºè®¡ç®—ATRã€å¸ƒæ—å¸¦ç­‰æŒ‡æ ‡
â”‚
â”‚ low_price      : {bar.low_price}
â”‚ è¯´æ˜           : æœ€ä½ä»· - è¯¥åˆ†é’Ÿå†…çš„æœ€ä½æˆäº¤ä»·
â”‚ ç”¨é€”           : ç”¨äºæ”¯æ’‘é˜»åŠ›ä½åˆ†æ
â”‚
â”‚ close_price    : {bar.close_price}
â”‚ è¯´æ˜           : æ”¶ç›˜ä»· - è¯¥åˆ†é’Ÿæœ€åä¸€ç¬”æˆäº¤ä»·æ ¼
â”‚ é‡è¦æ€§         : â­â­â­â­â­ æœ€å¸¸ç”¨äºæŠ€æœ¯æŒ‡æ ‡è®¡ç®—
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€ æˆäº¤ä¿¡æ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”‚ volume         : {bar.volume}
â”‚ è¯´æ˜           : æˆäº¤é‡ - è¯¥åˆ†é’Ÿçš„æˆäº¤æ‰‹æ•°
â”‚ å•ä½           : æ‰‹ï¼ˆ1æ‰‹ = 10å¨ï¼Œå¯¹äºèºçº¹é’¢ï¼‰
â”‚ ç”¨é€”           : åˆ¤æ–­å¸‚åœºæ´»è·ƒåº¦ã€éªŒè¯ä»·æ ¼çªç ´
â”‚ æ³¨æ„           : å¤œç›˜å’Œå¼€ç›˜åˆæœŸæˆäº¤é‡é€šå¸¸è¾ƒå°
â”‚
â”‚ turnover       : {bar.turnover}
â”‚ è¯´æ˜           : æˆäº¤é¢ - è¯¥åˆ†é’Ÿçš„æˆäº¤é‡‘é¢
â”‚ å•ä½           : å…ƒ
â”‚ è®¡ç®—å…¬å¼       : çº¦ç­‰äº æˆäº¤ä»·æ ¼ Ã— æˆäº¤é‡ Ã— åˆçº¦ä¹˜æ•°
â”‚ ç”¨é€”           : èµ„é‡‘æµå‘åˆ†æ
â”‚
â”‚ open_interest  : {bar.open_interest}
â”‚ è¯´æ˜           : æŒä»“é‡ - è¯¥æ—¶åˆ»çš„æœªå¹³ä»“åˆçº¦æ•°
â”‚ å•ä½           : æ‰‹
â”‚ é‡è¦æ€§         : â­â­â­ åæ˜ å¸‚åœºå‚ä¸åº¦
â”‚ ç‰¹ç‚¹           : æŒä»“é‡å¢åŠ  = æ–°èµ„é‡‘å…¥åœº
â”‚               æŒä»“é‡å‡å°‘ = èµ„é‡‘ç¦»åœº
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    """)
    
    print("=" * 80)
    print("é‡è¦æ¦‚å¿µè§£é‡Š")
    print("=" * 80)
    
    print("""
1. ğŸ“Š OHLCï¼ˆOpen High Low Closeï¼‰
   - æŠ€æœ¯åˆ†æçš„åŸºç¡€ï¼Œå‡ ä¹æ‰€æœ‰æŒ‡æ ‡éƒ½åŸºäºè¿™å››ä¸ªä»·æ ¼
   - Kçº¿å›¾å°±æ˜¯ç”±OHLCç»˜åˆ¶è€Œæˆ
   
2. ğŸ”¢ æˆäº¤é‡ vs æŒä»“é‡
   - æˆäº¤é‡ï¼šäº¤æ˜“æ´»è·ƒåº¦ï¼Œå½“å¤©ä¹°å–çš„æ‰‹æ•°
   - æŒä»“é‡ï¼šå¸‚åœºæ·±åº¦ï¼Œæœªå¹³ä»“çš„åˆçº¦æ€»æ•°
   - æˆäº¤é‡å¤§ã€æŒä»“é‡å¢ â†’ å¼ºåŠ¿è¡Œæƒ…
   - æˆäº¤é‡å¤§ã€æŒä»“é‡å‡ â†’ åè½¬ä¿¡å·
   
3. â° æ—¶é—´æˆ³æ³¨æ„äº‹é¡¹
   - datetimeæ˜¯Kçº¿å¼€å§‹æ—¶é—´
   - ä¾‹å¦‚ï¼š09:30:00çš„Kçº¿ï¼ŒåŒ…å«09:30:00åˆ°09:30:59çš„æ•°æ®
   - æ”¶ç›˜ä»·æ˜¯09:30:59çš„æœ€åæˆäº¤ä»·
   
4. ğŸ”„ æ•°æ®æ›´æ–°é¢‘ç‡
   - 1åˆ†é’ŸKçº¿ï¼šæ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡
   - å®ç›˜æ—¶ï¼šå®æ—¶æ¨é€
   - å›æµ‹æ—¶ï¼šé€æ ¹Kçº¿å›æ”¾
   
5. ğŸ’° ä»·æ ¼å•ä½
   - èºçº¹é’¢ï¼šå…ƒ/å¨
   - é»„é‡‘ï¼šå…ƒ/å…‹
   - åŸæ²¹ï¼šå…ƒ/æ¡¶
   - ä¸åŒå“ç§å•ä½ä¸åŒï¼Œéœ€è¦æ³¨æ„
    """)
    
    print("=" * 80)
    print("å®é™…åº”ç”¨ç¤ºä¾‹")
    print("=" * 80)
    
    print("""
# 1. è®¡ç®—æ¶¨è·Œå¹…
change_pct = (close_price - open_price) / open_price * 100

# 2. åˆ¤æ–­Kçº¿ç±»å‹
if close_price > open_price:
    print("é˜³çº¿ - ä¸Šæ¶¨")
elif close_price < open_price:
    print("é˜´çº¿ - ä¸‹è·Œ")
else:
    print("åå­—æ˜Ÿ - éœ‡è¡")

# 3. è®¡ç®—æŒ¯å¹…
amplitude = (high_price - low_price) / open_price * 100

# 4. åˆ¤æ–­æˆäº¤æ´»è·ƒåº¦
if volume > avg_volume * 2:
    print("æ”¾é‡çªç ´")
    """)
    
    print("\n" + "=" * 80)

else:
    print("âŒ æ²¡æœ‰æ‰¾åˆ°æ•°æ®")

